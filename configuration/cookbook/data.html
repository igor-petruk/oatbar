<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Data - Oatbar</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Oatbar</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/igor-petruk/oatbar/tree/main" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/igor-petruk/oatbar/edit/main/book/src/configuration/cookbook/data.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="data"><a class="header" href="#data">Data</a></h1>
<p>This chapter contains examples of common sources and methods of ingesting
data for your blocks.</p>
<ul>
<li><a href="#common-blocks">Common Blocks</a>
<ul>
<li><a href="#app-launcher">App Launcher</a></li>
<li><a href="#clock">Clock</a></li>
<li><a href="#keyboard">Keyboard</a>
<ul>
<li><a href="#layout">Layout</a></li>
<li><a href="#indicators">Indicators</a></li>
</ul>
</li>
<li><a href="#active-workspaces-and-windows">Active workspaces and windows</a></li>
<li><a href="#system-stats">System stats</a></li>
<li><a href="#disk-space">Disk space</a></li>
</ul>
</li>
<li><a href="#third-party-sources">Third-party sources</a>
<ul>
<li><a href="#i3status"><code>i3status</code></a></li>
<li><a href="#conky"><code>conky</code></a></li>
<li><a href="#i3blocks"><code>i3blocks</code></a></li>
<li><a href="#http-apis">HTTP APIs</a></li>
<li><a href="#file">File</a></li>
<li><a href="#socket">Socket</a></li>
</ul>
</li>
</ul>
<h2 id="common-blocks"><a class="header" href="#common-blocks">Common Blocks</a></h2>
<h3 id="app-launcher"><a class="header" href="#app-launcher">App Launcher</a></h3>
<pre><code class="language-toml">[[block]]
name='browser'
type = 'text'
value = "&lt;span font='Font Awesome 6 Free 22'&gt;&lt;/span&gt; "
on_mouse_left = 'chrome'
</code></pre>
<h3 id="clock"><a class="header" href="#clock">Clock</a></h3>
<pre><code class="language-toml">[[command]]
name="clock"
command="date '+%a %b %e %H:%M:%S'"
interval=1

[[block]]
name = 'clock'
type = 'text'
value = '${clock:value}'
</code></pre>
<p>If you do not need to show seconds, you can make <code>interval</code> smaller.</p>
<h3 id="keyboard"><a class="header" href="#keyboard">Keyboard</a></h3>
<p><code>oatbar</code> ships with keyboard status utility that streams keyboard layouts
and indicator values in <code>i3bar</code> format.</p>
<p>If you run it, you will see</p>
<pre><code class="language-json">❯ oatbar-keyboard
{"version":1}
[
[{"full_text":"layout: us","name":"layout","active":0,"value":"us","variants":"us,ua"},
{"full_text":"caps_lock:off","name":"indicator","instance":"caps_lock","value":"off"},
 ...],
</code></pre>
<p>Enable it with</p>
<pre><code class="language-toml">[[command]]
name="keyboard"
command="oatbar-keyboard"
</code></pre>
<h4 id="layout"><a class="header" href="#layout">Layout</a></h4>
<p><code>oatbar-keyboard</code> is designed to work with <code>setxkbmap</code>.
For example you set up your layouts on each WM start like this:</p>
<pre><code class="language-shell">setxkbmap -layout us,ua -option grp:alt_space_toggle
</code></pre>
<p>Enable <code>oatbar-keyboard</code> and use an <code>enum</code> block:</p>
<pre><code class="language-toml">[[block]]
name = 'layout'
type = 'enum'
active = '${keyboard:layout.active}'
variants = '${keyboard:layout.variants}'
on_mouse_left = "oatbar-keyboard layout set $BLOCK_INDEX"
</code></pre>
<h4 id="indicators"><a class="header" href="#indicators">Indicators</a></h4>
<p>Show indicators, such as <code>caps_lock</code>, <code>scroll_lock</code> and <code>num_lock</code>
as follows:</p>
<pre><code class="language-toml">[[block]]
name = 'caps_lock'
type = 'text'
value = '${keyboard:indicator.caps_lock.full_text}'
</code></pre>
<h3 id="active-workspaces-and-windows"><a class="header" href="#active-workspaces-and-windows">Active workspaces and windows</a></h3>
<p><code>oatbar-desktop</code> talks to your WM via EWMH protocol to obtain
the information about active workspaces and windows.</p>
<pre><code class="language-json">❯ oatbar-desktop
{"version":1}
[
[{"full_text":"workspace: 1","name":"workspace","active":0,"value":"1","variants":"1,2,3"},
{"full_text":"window: Alacritty","name":"window_title","value":"Alacritty"}],
</code></pre>
<pre><code class="language-toml">[[command]]
name="desktop"
command="oatbar-desktop"

[[block]]
name = 'workspace'
type = 'enum'
active = '${desktop:workspace.active}'
variants = '${desktop:workspace.variants}'
# Optional replacement with icons
replace = [
   ["1",""],
   ["2",""],
   ["3",""]
]
font="Font Awesome 6 Free 13"
on_mouse_left = "oatbar-desktop $BLOCK_INDEX"

[[block]]
name='window'
type = 'text'
value = '${desktop:window_title.value|max:100}'
pango_markup = false  # Window title can happen to have HTML.
</code></pre>
<h3 id="system-stats"><a class="header" href="#system-stats">System stats</a></h3>
<p><code>oatbar</code> ships with a <code>oatbar-stats</code> utility that streams system stats in the <code>i3bar</code>
format:</p>
<ul>
<li>CPU</li>
<li>Memory</li>
<li>Network
<ul>
<li>Interface names</li>
<li>Running status</li>
<li>Address</li>
<li>Download and upload rates</li>
</ul>
</li>
</ul>
<p>There is a lot of data you can display on your <code>blocks</code>. Enable <code>oatbar-stats</code>
like this:</p>
<pre><code class="language-toml">[[command]]
name="stats"
command="oatbar-stats"
</code></pre>
<p>Restart <code>oatbar</code> and examine the new variables.</p>
<pre><code class="language-shell">oatctl var ls | grep '^stats:'
</code></pre>
<p>The example output below.</p>
<pre><code class="language-ini">stats:cpu.full_text=cpu:  2%
stats:cpu.percent=2
stats:memory.free=8744980480
stats:memory.full_text=mem: 73% 32.9 GB
stats:memory.percent=73
stats:memory.total=32915705856
stats:memory.used=24170725376
stats:net.igc0.full_text=igc0: 192.168.0.160
stats:net.igc0.ipv4_0_addr=192.168.0.160
stats:net.igc0.ipv4_0_broadcast=192.168.0.255
stats:net.igc0.ipv4_0_run=true
stats:net.igc0.ipv4_0_up=true
stats:net.igc0.mac_0_addr=48:21:0b:35:ca:08
stats:net.igc0.mac_0_run=true
stats:net.igc0.mac_0_up=true
stats:net.igc0.rx_per_sec=1704
stats:net.igc0.tx_per_sec=1110
...
</code></pre>
<p>Entries with <code>full_text</code> are a good start to display directly,
if you do not need more fine grained customizations.</p>
<pre><code class="language-toml">[[block]]
name="ethernet"
type="text"
value="${stats:net.igc0.full_text}"
</code></pre>
<h3 id="disk-space"><a class="header" href="#disk-space">Disk space</a></h3>
<p>Example for <code>/home</code> directory partition:</p>
<pre><code class="language-toml">[[command]]
name="home_free"
command="df -h /home | tail -1 | awk '{print $5}'"
interval=60

[[block]]
name='home_free'
type = 'text'
value = '&lt;b&gt;/home&lt;/b&gt; ${home_free:value}'
</code></pre>
<h2 id="third-party-sources"><a class="header" href="#third-party-sources">Third-party sources</a></h2>
<p>Existing bar ecosystems already can provide large mount of useful information.
<code>oatbar</code> by-design focuses on making it possible to adapt third-party data sources.</p>
<h3 id="i3status"><a class="header" href="#i3status"><code>i3status</code></a></h3>
<p><code>i3status</code> is a great cross-platform source of information about the system. It supports:</p>
<ul>
<li>CPU</li>
<li>Memory</li>
<li>Network</li>
<li>Battery</li>
<li>Volume</li>
</ul>
<p><code>i3status</code> is designed to be used by <code>i3bar</code>, but <code>oatbar</code> supports this format natively.
Enable it in <code>~/.i3status.conf</code> or in <code>~/.config/i3status/config</code>:</p>
<pre><code class="language-conf">general {
        output_format = "i3bar"
}
</code></pre>
<p>Add you plugin as described in the <a href="https://i3wm.org/docs/i3status.html"><code>i3status</code> documentation</a>.
Prefer simple output format, as you can format it on the <code>oatbar</code> side. Example:</p>
<pre><code>order += cpu_usage

cpu_usage {
   format = "%usage"
}
</code></pre>
<p>If you run <code>i3status</code> you will now see</p>
<pre><code class="language-json">❯ i3status
{"version":1}
[
[{"name":"cpu_usage","markup":"none","full_text":"00%"}]
,[{"name":"cpu_usage","markup":"none","full_text":"02%"}]
</code></pre>
<p>In <code>oatbar</code> config:</p>
<pre><code class="language-toml">[[block]]
name='cpu'
type = 'number'
value = "${i3status:cpu_usage.full_text}"
number_type = "percent"
output_format="&lt;b&gt;CPU:&lt;/b&gt;${value}"
number_display="text"
</code></pre>
<p>If you prefer a progress bar:</p>
<pre><code class="language-toml">number_display="progress_bar"
</code></pre>
<h3 id="conky"><a class="header" href="#conky"><code>conky</code></a></h3>
<p>As <code>i3status</code>, <code>conky</code> can also be a great source of system data.</p>
<p><code>conky</code> can print it's <a href="https://conky.sourceforge.net/variables.html">variables</a> as plain text
and <code>oatbar</code> can consume it as multi-line plain text. Example <code>~/.oatconkyrc</code>:</p>
<pre><code class="language-lua">conky.config = {
    out_to_console = true,
    out_to_x = false,
    update_interval = 1.0,
}

conky.text = [[
$memperc%
$cpu%
]]
</code></pre>
<p>If you run <code>conky -c ~/.oatconkyrc</code> you will see repeating groups of numbers:</p>
<pre><code>2%
10%
5%
10%
</code></pre>
<p>In <code>oatbar</code> config:</p>
<pre><code class="language-toml">[[command]]
name="conky"
command="conky -c ~/.oatconkyrc"
line_names=["mem","cpu"]

[[block]]
name='cpu'
type = 'number'
value = "${conky:cpu}"
number_type = "percent"

[block.number_display]
type="text"
output_format="&lt;b&gt;CPU:&lt;/b&gt;${value}"

[[block]]
name='mem'
type = 'number'
value = "${conky:mem}"
number_type = "percent"

[block.number_display]
type="text"
output_format="&lt;b&gt;MEM:&lt;/b&gt;${value}"
</code></pre>
<h3 id="i3blocks"><a class="header" href="#i3blocks"><code>i3blocks</code></a></h3>
<p><code>i3blocks</code> in a drop-in replacement for <code>i3status</code> to be used in
<code>i3bar</code>. If you have existingi <code>i3blocks</code> configs, feel free to plug it
directly into <code>oatbar</code>:</p>
<pre><code class="language-toml">[[command]]
name="i3blocks"
command="i3blocks"
</code></pre>
<p>You can check which <code>oatbar</code> variables it makes available by running
<code>i3blocks</code> in your console.</p>
<p>The indirection between the script, <code>i3blocks</code> and <code>oatbar</code> is not required.
You can connect any plugin from the <a href="https://github.com/vivien/i3blocks-contrib"><code>i3block-contrib</code></a>
excellent collection directly into <code>oatbar</code>.</p>
<p>For example:</p>
<pre><code class="language-console">$ git clone https://github.com/vivien/i3blocks-contrib
$ cd ./i3blocks-contrib/cpu_usage2
$ make
$ ./cpu_usage2 -l "cpu: "
cpu: &lt;span&gt; 39.79%&lt;/span&gt;
cpu: &lt;span&gt; 47.06%&lt;/span&gt;
</code></pre>
<p>As you can see, it inputs only one line of data each interval,
so setting <code>line_names</code> is not necessary, however always check for it.</p>
<pre><code class="language-toml">[[command]]
name="cpu_usage2"
command="/path/to/cpu_usage2 -l 'cpu: '"

[[block]]
name="cpu_usage2"
type="text"
value="${cpu_usage2:value}"
</code></pre>
<h3 id="http-apis"><a class="header" href="#http-apis">HTTP APIs</a></h3>
<p>HTTP JSON APIs that do not require complicated login are extremely
easy to integrate using <code>curl</code> and <code>jq</code>.</p>
<p>Explore your JSON first</p>
<pre><code class="language-console">$ curl 'https://api.ipify.org?format=json'
{"ip":"1.2.3.4"}
</code></pre>
<p><code>jq -r</code> let's you extract a value from a JSON object. Add the command
to <code>oatbar</code> config, but make sure to set a sufficient <code>interval</code> not to get
banned.</p>
<pre><code class="language-toml">[[command]]
name="ip"
command="curl 'https://api.ipify.org?format=json | jq -r .ip"
interval=1800

[[block]]
name="ip"
type="text"
value="my ip: ${ip:value}"
</code></pre>
<h3 id="file"><a class="header" href="#file">File</a></h3>
<p>You can use file watching utils to output file contents on any file change.
For example for Linux you can use <code>fswatch</code>.</p>
<pre><code class="language-toml">[[command]]
command="cat ./file; fswatch --event Updated ./file | xargs -I {} cat {}"
</code></pre>
<h3 id="socket"><a class="header" href="#socket">Socket</a></h3>
<p>Use <code>socat</code> to read from sockets. TCP socket:</p>
<pre><code class="language-toml">[[command]]
command="socat TCP:localhost:7777 -"
</code></pre>
<p>SSL socket:</p>
<pre><code class="language-toml">[[command]]
command="socat OPENSSL:localhost:7777 -"
</code></pre>
<p>For Unix socket:</p>
<pre><code class="language-toml">[[command]]
command="socat UNIX-CONNECT:/path/to/socket -"
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../configuration/cookbook/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../configuration/cookbook/appearance.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../configuration/cookbook/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../configuration/cookbook/appearance.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
